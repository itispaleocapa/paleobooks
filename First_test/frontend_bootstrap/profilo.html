<!doctype html>
<html lang="it">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <title>PALEObooks</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">

  </head>

  <nav class="navbar navbar-expand-lg navbar-light bg-light" style="background-color: chocolate;">
    <a class="navbar-brand" href="#">PALEObooks  </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav">
        <li class="nav-item">
          <a class="nav-link" href="#"> HOME </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="vendi.html"> OFFRI </a>
        </li>
        <li class="nav-item active">
          <a class="nav-link" href="#"> PROFILO <span class="sr-only">(current)</span> </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="login.html"> LOGIN  </a>
        </li>

        <li class="nav-item">
            <a class="nav-link" href="registrati.html"> REGISTRATI </a>
        </li>

       
      </ul>
    </div>
</nav>

<body style="margin: 10px; text-align: center;">
    <h2> Profilo </h2>

    <div id="out" class="container-fluid">

      <br>

    

    </div>


    <button type="button" class="btn btn-primary" onclick="modifica()" style="display: none;" id="bottone" > Modifica INFO </button>


    <form id="form" style="display: none;">
      <label for="name">Nome</label><br>
      <input type="name" id="name" name="name" placeholder="Inserisci nome" style="text-align: center;"><br>
      <label for="email">Email</label><br>
      <input type="email" id="email" name="email" placeholder="Inserisci email" style="text-align: center;"><br>
      <label for="password">Password</label><br>
      <input type="password" id="password" name="password" placeholder="inserisci password" style="text-align: center;"><br>
      <br>
      <input type="submit" value="Modifica" class="btn btn-danger">
    </form>

  



    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
  </body>



  <footer>
    <button type="button" class="btn btn-danger" onclick="logout()">LOGOUT</button>
  </footer>
</html>

<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script>

    $(document).ready(function () {
        profile();
    });

    $("#form").submit(function (event) {
        event.preventDefault();
        profile_update('https://www.paleobooks.it/pbapi/public/users', $(this).serialize());
    });

    function profile_update(url, data){
      $.ajax({
            type: 'PUT',
            dataType: 'json',
            url: url,
            data:  {"access_token": sessionStorage.getItem('access_token')},
            
            error: (err) => {
                console.log(err);

                if(err.status == 404){
                    //Utente non loggato
                    console.log("Errore");
                }
            },
            success: (response) => {
              console.log(response);
            }
        });

    }

    function logout(){
      $.ajax({
            type: 'POST',
            dataType: 'json',
            url: 'https://www.paleobooks.it/pbapi/public/auth/logout',
            data: {"access_token": sessionStorage.getItem('access_token')},
            error: (err) => {
                console.log(err);

                if(err.status == 404){
                    //Utente non loggato
                    console.log("Errore");
                }
            },
            success: (response) => {
              console.log(response);
              alert("logout effettuato");
              sessionStorage.removeItem('access_token');
              window.location.href = "login.html"
            }
        });
    }


    function modifica(){
      if(document.getElementById("form").style.display == "none")
      { 
        document.getElementById("form").style.display = "block";
      }
       else{
        document.getElementById("form").style.display = "none";
       }
    }

    function profile() {
        $.ajax({
            type: 'GET',
            dataType: 'json',
            url: 'https://www.paleobooks.it/pbapi/public/users/profile',
            data: {"access_token": sessionStorage.getItem('access_token')},

            error: (err) => {
                console.log(err);

                if(err.status == 404){
                    //Utente non loggato
                    console.log("Errore");
                }
            },
            success: (response) => {
              
              /*
              <table class="table table-striped">
                  <thead>
                    <tr>
                      <th scope="col">#</th>
                      <th scope="col">First</th>
                      <th scope="col">Last</th>
                      <th scope="col">Handle</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr>
                      <th scope="row">1</th>
                      <td>Mark</td>
                      <td>Otto</td>
                      <td>@mdo</td>
                    </tr>
                  */

                var x = document.getElementById("out");
              
                var tab = document.createElement('table');
                tab.setAttribute('class', 'table table-striped');
               

                var tbody = document.createElement("tbody");
                
                var tr = document.createElement("tr");

                var td1 = document.createElement("td");
                td1.innerHTML = "Nome:"
                var td2 = document.createElement("td");
                td2.innerHTML = response.name;

                tr.appendChild(td1);
                tr.appendChild(td2);

                tbody.appendChild(tr);


                var tr = document.createElement("tr");

                var td1 = document.createElement("td");
                td1.innerHTML = "Email:"
                var td2 = document.createElement("td");
                td2.innerHTML = response.email;

                tr.appendChild(td1);
                tr.appendChild(td2);

                tbody.appendChild(tr);

                tab.appendChild(tbody);


             

                x.appendChild(tab);

                document.getElementById("bottone").style.display = "inline";



           

                //window.location.href = "../";
            }
        });
    }
</script>