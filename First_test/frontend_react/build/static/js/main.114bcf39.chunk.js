(this.webpackJsonpfrontend_react=this.webpackJsonpfrontend_react||[]).push([[0],{128:function(e,t,a){e.exports=a(146)},133:function(e,t,a){},134:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},135:function(e,t,a){},146:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),o=a(11),l=a.n(o),i=(a(133),a(12)),s=a(14),c=a(13),u=(a(134),a(135),a(22)),m=a(16),p=a(48),d=a(15),h=a(190),g=a(40),f=a(224),E=a(115),b=a(197),k=a(198),y=a(199),v=a(200),S=a(201),C=a(202),O={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(r,o){fetch("https://www.paleobooks.it/pbapi/public"+e,{method:t,headers:{"Content-Type":"application/json",Authorization:"Bearer "+(null!==n?n:sessionStorage.getItem("access_token"))},body:a}).then((function(n){n.status<200||n.status>299?"/auth/login"!==e&&"/auth/paleoid"!==e&&"/auth/refresh-token"!==e&&400===n.status&&null!=localStorage.getItem("refresh_token")?n.json().then((function(n){n.error.includes("access token")?O.request("/auth/refresh-token","POST",null,localStorage.getItem("refresh_token")).then((function(n){sessionStorage.setItem("access_token",n.access_token),O.request(e,t,a).then((function(e){r(e)})).catch((function(){o()}))})).catch((function(){o()})):o(n)})):n.json().then((function(e){o(e)})).catch((function(){o()})):n.json().then((function(e){r(e)}))}))}))},login:function(e,t){return new Promise((function(a,n){O.request("/auth/login","POST",JSON.stringify({email:e,password:t})).then((function(e){sessionStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token),localStorage.setItem("user_class",""),a()})).catch((function(){n()}))}))},loginPaleoID:function(e){return new Promise((function(t,a){O.request("/auth/paleoid","POST",JSON.stringify({code:e,redirect_uri:"https://books.paleo.bg.it/login"})).then((function(e){sessionStorage.setItem("access_token",e.access_token),localStorage.setItem("refresh_token",e.refresh_token),localStorage.setItem("user_class",e.class),t()})).catch((function(){a()}))}))},logout:function(){sessionStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")},isLoggedIn:function(){return new Promise((function(e,t){O.request("/users/profile").then((function(t){localStorage.setItem("user_id",t.id),localStorage.setItem("user_email",t.email),e()})).catch((function(){t()}))}))}},x=O,B=a(189),j=a(185),w=a(196),I=a(107),L=a.n(I),_=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleInputChange=function(e,t){n.setState(Object(p.a)({},e,t.target.value))},n.handleKeyPress=function(e){"Enter"===e.key&&n.handleLogin()},n.handleLogin=function(){n.setState({isLoading:!0}),x.login(n.state.email,n.state.password).then((function(e){n.props.checkLogin()})).catch((function(){n.setState({dialogTitle:"Errore",dialogContent:"Credenziali non valide",dialogOpen:!0}),n.setState({isLoading:!1})}))},n.handleRegistrationBtn=function(){n.setState({dialogTitle:"Attenzione",dialogContent:"Questa funzione non \xe8 ancora disponibile",dialogOpen:!0})},n.dialogHandleClose=function(){n.setState({dialogOpen:!1})},n.state={name:"",email:"",password:"",isLoading:!1},n.state.paleoIdUrl="https://id.paleo.bg.it/oauth/authorize?client_id=ae13b6e3fd3c0fccad39c5fcb8fda00d&response_type=code&state=paleobooks&redirect_uri="+encodeURIComponent("https://books.paleo.bg.it/login"),n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=L.a.parse(this.props.location.search);"paleobooks"===t.state&&(this.setState({isLoading:!0}),x.loginPaleoID(t.code).then((function(){e.props.checkLogin()})).catch((function(){e.setState({dialogTitle:"Errore",dialogContent:"Autenticazione con PaleoID fallita",dialogOpen:!0}),e.setState({isLoading:!1})})))}},{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(j.a,{position:"static",style:{alignItems:"center"}},r.a.createElement(B.a,null,r.a.createElement(g.a,{variant:"h6"},"PALEObooks"))),r.a.createElement(h.a,{style:{alignItems:"center",marginTop:"10px"}},r.a.createElement("img",{src:"https://i.imgur.com/jMTzBKa.png",style:{width:"30%",maxWidth:"175px",margin:"15px auto",display:"block"}}),r.a.createElement(E.a,{style:{maxWidth:"500px",padding:"15px",margin:"0 auto"}},r.a.createElement("form",{noValidate:!0,autoComplete:"off"},r.a.createElement(g.a,{variant:"h4",style:{textAlign:"center"}},"Login"),r.a.createElement(f.a,{id:"outlined-basic",label:"Email",variant:"outlined",fullWidth:!0,style:{marginTop:"10px"},onChange:function(t){return e.handleInputChange("email",t)},onKeyPress:this.handleKeyPress,autoFocus:!0}),r.a.createElement(f.a,{id:"outlined-basic",label:"Password",variant:"outlined",fullWidth:!0,type:"password",style:{marginTop:"10px"},onChange:function(t){return e.handleInputChange("password",t)},onKeyPress:this.handleKeyPress}),this.state.isLoading?r.a.createElement(w.a,{style:{margin:"8px"}}):r.a.createElement("div",{style:{marginTop:"20px"}}),r.a.createElement("div",{style:{width:"fit-content",margin:"0px auto 10px"}},r.a.createElement(b.a,{variant:"contained",style:{marginRight:"4px"},onClick:this.handleLogin},"Accedi"),r.a.createElement(b.a,{variant:"contained",style:{marginLeft:"4px"},onClick:this.handleRegistrationBtn},"Registrati")),r.a.createElement("div",{style:{width:"fit-content",margin:"20px auto 0px"}},r.a.createElement(b.a,{variant:"contained",color:"primary",href:this.state.paleoIdUrl},"Accedi con PaleoID")))),r.a.createElement(k.a,{open:this.state.dialogOpen,onClose:this.dialogHandleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},r.a.createElement(y.a,{id:"alert-dialog-title"},this.state.dialogTitle),r.a.createElement(v.a,null,r.a.createElement(S.a,{id:"alert-dialog-description"},this.state.dialogContent)),r.a.createElement(C.a,null,r.a.createElement(b.a,{onClick:this.dialogHandleClose,color:"primary",autoFocus:!0},"Chiudi")))))}}]),a}(r.a.Component),D=Object(m.g)(_),z=a(203),T=a(114),q=function(e){var t=e.component,a=e.auth,n=e.wasInitialized,o=Object(T.a)(e,["component","auth","wasInitialized"]);return r.a.createElement(m.b,Object.assign({},o,{render:function(e){return!0===a?r.a.createElement(t,e):n?r.a.createElement(m.a,{to:"/login"}):""}}))},F=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleLogout=function(){x.logout(),n.props.checkLogin()},n}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{variant:"h4",style:{textAlign:"center",marginTop:"15px"}},"Ciao, sono la home page!"),r.a.createElement(b.a,{variant:"contained",color:"secondary",style:{margin:"10px auto",display:"block"},onClick:this.handleLogout},"Logout"))}}]),a}(r.a.Component),P=a(80),M=a(219),A=a(226),N=a(222),R=a(207),W=a(195),H=a(148),V=a(205),Y=a(111),J=a.n(Y),K=a(217),U=a(17),Q=a(206),G=a(218),$=a(113),X=a(215),Z=a(225),ee=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(){var e;return Object(i.a)(this,n),(e=t.call(this)).state={name:"",email:"",emailmd5:""},e}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;x.request("/users/profile").then((function(t){var n=a(77);e.setState({name:t.name,email:t.email,emailmd5:n(t.email.toLowerCase())})}))}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Z.a,{alt:this.state.name,src:"https://gravatar.com/avatar/"+this.state.emailmd5+"?d=retro",style:{width:"56px",height:"56px"}}),r.a.createElement(g.a,{variant:"subtitle1",gutterBottom:!0,style:{marginTop:"0.4rem",marginBottom:"-0.3rem"}},this.state.name),r.a.createElement(g.a,{variant:"caption",gutterBottom:!0},this.state.email))}}]),n}(r.a.Component),te=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){return Object(i.a)(this,a),t.call(this,e)}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{variant:"h4",style:{textAlign:"center",marginTop:"15px"}},"Questa \xe8 la pagina del profilo"))}}]),a}(r.a.Component),ae=a(112),ne=a(193),re=a(227),oe=a(220),le=a(210),ie=a(209),se=a(204),ce=function(e){Object(s.a)(n,e);var t=Object(c.a)(n);function n(e){var a;return Object(i.a)(this,n),(a=t.call(this,e)).state={loading:!0,name:"",email:"",emailmd5:"",price:0},a}return Object(d.a)(n,[{key:"componentDidMount",value:function(){var e=this;"supply"==this.props.type?x.request("/supplies/"+this.props.id).then((function(t){var n=a(77);e.setState({loading:!1,name:t.user.name,email:t.user.email,emailmd5:n(t.user.email.toLowerCase()),price:t.price})})):"demand"==this.props.type&&x.request("/demands/"+this.props.id).then((function(t){var n=a(77);e.setState({loading:!1,name:t.user.name,email:t.user.email,emailmd5:n(t.user.email.toLowerCase()),price:t.price})}))}},{key:"render",value:function(){var e=this;return this.state.loading?r.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},r.a.createElement(z.a,null)):r.a.createElement(H.a,{button:!0,onClick:function(){return window.open("mailto:"+e.state.email,"_blank")},style:{padding:"6px 8px"}},r.a.createElement(se.a,null,r.a.createElement(Z.a,{alt:this.state.name,src:"https://gravatar.com/avatar/"+this.state.emailmd5+"?d=retro"})),r.a.createElement(V.a,{primary:r.a.createElement(ue,{name:this.state.name,price:this.state.price,email:this.state.email})}))}}]),n}(r.a.Component),ue=function(e){return r.a.createElement("div",null,r.a.createElement("p",{style:{float:"left",marginTop:"8px"}},e.name),null!=e.price?r.a.createElement(r.a.Fragment,null,r.a.createElement("p",{style:{float:"right",marginTop:"16px"}},"\u20ac ",parseFloat(e.price).toFixed(2)),r.a.createElement("p",{style:{float:"left",clear:"both",fontSize:"0.8em",color:"#555",marginTop:"-28px"}},e.email)):r.a.createElement("p",{style:{float:"left",clear:"both",fontSize:"0.8em",color:"#555",marginTop:"-22px"}},e.email))},me=ce,pe=a(223),de=a(221),he=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){return Object(i.a)(this,a),t.call(this,e)}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return n.createElement(n.Fragment,null,n.createElement(g.a,{gutterBottom:!0},1==this.props.users.length?n.createElement(n.Fragment,null,"C'\xe8 ",n.createElement("b",null,"1")," utente che ","supply"==this.props.type?"sta":"vuole"):n.createElement(n.Fragment,null,"Ci sono ",n.createElement("b",null,this.props.users.length)," utenti che ","supply"==this.props.type?"stanno":"vogliono"),"\xa0","supply"==this.props.type?"vendendo":"acquistare"," questo libro, contattal",1==this.props.users.length?"o":"i"," se sei interessato."),n.createElement(W.a,{style:{margin:"-16px 0"}},this.props.users.map((function(t){return n.createElement(me,{id:t.id,type:e.props.type})}))))}}]),a}(n.Component),ge=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).loadSupplies=function(){x.request("/books/"+n.props.book.id+"/supplies").then((function(e){n.setState({supplies:e.filter((function(e){return e.user_id!=localStorage.getItem("user_id")}))}),x.request("/books/"+n.props.book.id+"/demands").then((function(e){var t=e.filter((function(e){return e.user_id==localStorage.getItem("user_id")}));t.length>0?n.setState({userDemand:t[0]}):n.setState({userDemand:null}),n.setState({loading:!1})}))}))},n.createDemand=function(){x.request("/demands","POST",JSON.stringify({book_id:n.props.book.id})).then((function(){n.setState({snackBarOpen:!0,snackBarSeverity:"success",snackBarMessage:"Annuncio creato correttamente!"}),n.props.handleClose()})).catch((function(e){"You already have a demand for this book."==e.error&&(e.error="Hai gi\xe0 un annuncio per questo libro."),n.setState({snackBarOpen:!0,snackBarSeverity:"error",snackBarMessage:e.error}),n.props.handleClose()}))},n.deleteDemand=function(){null!==n.state.userDemand&&x.request("/demands/"+n.state.userDemand.id,"DELETE").then((function(){n.setState({snackBarOpen:!0,snackBarSeverity:"success",snackBarMessage:"Annuncio eliminato correttamente!",userDemand:null}),n.props.handleClose()})).catch((function(e){n.setState({snackBarOpen:!0,snackBarSeverity:"error",snackBarMessage:e.error}),n.props.handleClose()}))},n.handleClose=function(){n.props.handleClose()},n.handleSnackbarClose=function(){n.setState({snackBarOpen:!1})},n.state={loading:!0,supplies:[],userDemand:null},n}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{onClose:this.handleClose,"aria-labelledby":"customized-dialog-title",open:this.props.open,onEnter:this.loadSupplies},r.a.createElement(y.a,{className:"dialog-title-text-ellipsis",onClose:this.handleClose},this.props.book.title),r.a.createElement(v.a,{dividers:!0},this.state.loading?r.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},r.a.createElement(z.a,null)):r.a.createElement(r.a.Fragment,null,this.state.supplies.length>0?r.a.createElement(r.a.Fragment,null,r.a.createElement(he,{users:this.state.supplies,type:"supply"}),r.a.createElement(Q.a,{style:{margin:"8px 0 12px"}}),null===this.state.userDemand?r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{gutterBottom:!0},"Oppure crea un annuncio per essere contattato da altri venditori."),r.a.createElement(g.a,{gutterBottom:!0},"Verr\xe0 condiviso il tuo nome e l'indirizzo email ",r.a.createElement("i",null,localStorage.getItem("user_email")),".",r.a.createElement("br",null),"Se non \xe8 corretto, modificalo dal tuo ",r.a.createElement(u.b,{to:"/profile",style:{color:"#0000ee"}},"profilo"),".")):null):null===this.state.userDemand?r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{gutterBottom:!0},"Sei interessato ad acquistare questo libro?",r.a.createElement("br",null),"Crea un annuncio per essere contattato dai possibili venditori!"),r.a.createElement(g.a,{gutterBottom:!0},"Verr\xe0 condiviso il tuo nome e l'indirizzo email ",r.a.createElement("i",null,localStorage.getItem("user_email")),".",r.a.createElement("br",null),"Se non \xe8 corretto, modificalo dal tuo ",r.a.createElement(u.b,{to:"/profile",style:{color:"#0000ee"}},"profilo"),".")):null,null!==this.state.userDemand?r.a.createElement(g.a,{gutterBottom:!0},"Hai gi\xe0 un annuncio per questo libro. Se l'hai gi\xe0 acquistato e non ti serve pi\xf9, clicca sul pulsante qui sotto per eliminarlo."):null)),r.a.createElement(C.a,null,r.a.createElement(b.a,{onClick:this.props.handleClose,color:"primary"},"Annulla"),null===this.state.userDemand?r.a.createElement(b.a,{autoFocus:!0,onClick:this.createDemand,color:"primary"},"Crea annuncio"):r.a.createElement(b.a,{autoFocus:!0,onClick:this.deleteDemand,color:"secondary"},"Elimina annuncio"))),r.a.createElement(pe.a,{open:this.state.snackBarOpen,autoHideDuration:6e3,onClose:this.handleSnackbarClose},r.a.createElement(fe,{onClose:this.handleSnackbarClose,severity:this.state.snackBarSeverity},this.state.snackBarMessage)))}}]),a}(r.a.Component),fe=function(e){return r.a.createElement(de.a,Object.assign({elevation:6,variant:"filled"},e))},Ee=ge,be=a(208),ke=a(228),ye=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).loadDemands=function(){x.request("/books/"+n.props.book.id+"/demands").then((function(e){n.setState({demands:e.filter((function(e){return e.user_id!=localStorage.getItem("user_id")}))}),x.request("/books/"+n.props.book.id+"/supplies").then((function(e){var t=e.filter((function(e){return e.user_id==localStorage.getItem("user_id")}));t.length>0?n.setState({userSupply:t[0]}):n.setState({userSupply:null}),n.setState({loading:!1})}))}))},n.createSupply=function(){parseFloat(n.state.price)<0?n.setState({snackBarOpen:!0,snackBarSeverity:"warning",snackBarMessage:"Il prezzo non pu\xf2 essere inferiore a 0"}):parseFloat(n.state.price)>n.props.book.price?n.setState({snackBarOpen:!0,snackBarSeverity:"warning",snackBarMessage:"Il prezzo non pu\xf2 essere superiore a \u20ac"+n.props.book.price}):x.request("/supplies","POST",JSON.stringify({book_id:n.props.book.id,price:parseFloat(n.state.price)})).then((function(){n.setState({snackBarOpen:!0,snackBarSeverity:"success",snackBarMessage:"Annuncio creato correttamente!"}),n.props.handleClose()})).catch((function(e){"You already have a supply for this book."==e.error&&(e.error="Hai gi\xe0 un annuncio di vendita per questo libro."),n.setState({snackBarOpen:!0,snackBarSeverity:"error",snackBarMessage:e.error}),n.props.handleClose()}))},n.deleteSupply=function(){null!==n.state.userSupply&&x.request("/supplies/"+n.state.userSupply.id,"DELETE").then((function(){n.setState({snackBarOpen:!0,snackBarSeverity:"success",snackBarMessage:"Annuncio eliminato correttamente!",userSupply:null}),n.props.handleClose()})).catch((function(e){n.setState({snackBarOpen:!0,snackBarSeverity:"error",snackBarMessage:e.error}),n.props.handleClose()}))},n.handleClose=function(){n.props.handleClose()},n.handleSnackbarClose=function(){n.setState({snackBarOpen:!1})},n.handlePriceChange=function(e){n.setState({price:e.target.value})},n.state={loading:!0,demands:[],userSupply:null,price:0},n}return Object(d.a)(a,[{key:"render",value:function(){var e=this;return r.a.createElement(r.a.Fragment,null,r.a.createElement(k.a,{onClose:this.handleClose,"aria-labelledby":"customized-dialog-title",open:this.props.open,onEnter:this.loadDemands},r.a.createElement(y.a,{className:"dialog-title-text-ellipsis",onClose:this.handleClose},this.props.book.title),r.a.createElement(v.a,{dividers:!0},this.state.loading?r.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},r.a.createElement(z.a,null)):r.a.createElement(r.a.Fragment,null,this.state.demands.length>0?r.a.createElement(r.a.Fragment,null,r.a.createElement(he,{users:this.state.demands,type:"demand"}),r.a.createElement(Q.a,{style:{margin:"8px 0 12px"}}),null===this.state.userSupply?r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{gutterBottom:!0},"Oppure crea un annuncio per essere contattato da altri possibili acquirenti."),r.a.createElement(g.a,{gutterBottom:!0},"Verr\xe0 condiviso il tuo nome e l'indirizzo email ",r.a.createElement("i",null,localStorage.getItem("user_email")),".",r.a.createElement("br",null),"Se non \xe8 corretto, modificalo dal tuo ",r.a.createElement(u.b,{to:"/profile",style:{color:"#0000ee"}},"profilo"),".")):null):null===this.state.userSupply?r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{gutterBottom:!0},"Vuoi vendere questo libro?",r.a.createElement("br",null),"Crea un annuncio per essere contattato dai possibili acquirenti!"),r.a.createElement(g.a,{gutterBottom:!0},"Verr\xe0 condiviso il tuo nome e l'indirizzo email ",r.a.createElement("i",null,localStorage.getItem("user_email")),".",r.a.createElement("br",null),"Se non \xe8 corretto, modificalo dal tuo ",r.a.createElement(u.b,{to:"/profile",style:{color:"#0000ee"}},"profilo"),".")):null,null!==this.state.userSupply?r.a.createElement(g.a,{gutterBottom:!0},"Hai gi\xe0 un annuncio di vendita per questo libro al prezzo di ",r.a.createElement("b",null,"\u20ac",this.state.userSupply.price),". Se l'hai gi\xe0 venduto e non ti serve pi\xf9, clicca sul pulsante qui sotto per eliminarlo."):null),null===this.state.userSupply?r.a.createElement(ne.a,{fullWidth:!0,variant:"outlined",style:{marginTop:"8px"}},r.a.createElement(re.a,{htmlFor:"outlined-adornment-amount"},"Prezzo di vendita"),r.a.createElement(ke.a,{id:"outlined-adornment-amount",onChange:function(t){return e.handlePriceChange(t)},type:"number",defaultValue:0,startAdornment:r.a.createElement(be.a,{position:"start"},"\u20ac"),labelWidth:125})):null),r.a.createElement(C.a,null,r.a.createElement(b.a,{onClick:this.props.handleClose,color:"primary"},"Annulla"),null===this.state.userSupply?r.a.createElement(b.a,{autoFocus:!0,onClick:this.createSupply,color:"primary"},"Crea annuncio"):r.a.createElement(b.a,{autoFocus:!0,onClick:this.deleteSupply,color:"secondary"},"Elimina annuncio"))),r.a.createElement(pe.a,{open:this.state.snackBarOpen,autoHideDuration:6e3,onClose:this.handleSnackbarClose},r.a.createElement(ve,{onClose:this.handleSnackbarClose,severity:this.state.snackBarSeverity},this.state.snackBarMessage)))}}]),a}(r.a.Component),ve=function(e){return r.a.createElement(de.a,Object.assign({elevation:6,variant:"filled"},e))},Se=ye,Ce=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleDemandOpen=function(){n.setState({demandDialogOpen:!0})},n.handleDemandClose=function(){n.setState({demandDialogOpen:!1})},n.handleSupplyOpen=function(){n.setState({supplyDialogOpen:!0})},n.handleSupplyClose=function(){n.setState({supplyDialogOpen:!1})},n.state={demandDialogOpen:!1,supplyDialogOpen:!1},n}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(ie.a,{key:this.props.book.id},r.a.createElement(le.a,{align:"center"},r.a.createElement("img",{src:this.props.book.photo,height:"100px"})),r.a.createElement(le.a,{align:"left"},this.props.book.title),r.a.createElement(le.a,{align:"left"},this.props.book.isbn),r.a.createElement(le.a,{align:"left"},"\u20ac",this.props.book.price),r.a.createElement(le.a,{align:"center"},r.a.createElement(b.a,{variant:"outlined",color:"primary",style:{margin:"4px"},onClick:this.handleDemandOpen},"Cerca"),r.a.createElement(b.a,{variant:"outlined",color:"primary",style:{margin:"4px"},onClick:this.handleSupplyOpen},"Offri")),r.a.createElement(Ee,{book:this.props.book,open:this.state.demandDialogOpen,handleClose:this.handleDemandClose}),r.a.createElement(Se,{book:this.props.book,open:this.state.supplyDialogOpen,handleClose:this.handleSupplyClose}))}}]),a}(r.a.Component),Oe=a(212),xe=a(213),Be=a(214),je=a(211),we=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){return Object(i.a)(this,a),t.call(this,e)}return Object(d.a)(a,[{key:"render",value:function(){return r.a.createElement(je.a,{component:E.a,style:{marginTop:"20px"}},r.a.createElement(Oe.a,{"aria-label":"simple table"},r.a.createElement(xe.a,null,r.a.createElement(ie.a,null,r.a.createElement(le.a,{align:"center"},"Immagine"),r.a.createElement(le.a,{align:"left"},"Titolo"),r.a.createElement(le.a,{align:"left"},"ISBN"),r.a.createElement(le.a,{align:"left"},"Prezzo"),r.a.createElement(le.a,{align:"center"},"Azioni"))),r.a.createElement(Be.a,null,this.props.books.map((function(e){return r.a.createElement(Ce,{key:e.id,book:e})})))))}}]),a}(r.a.Component),Ie=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleClassChange=function(e){n.setState({_class:e.target.value}),n.updateYears(e.target.value)},n.handleYearChange=function(e){n.setState({year:e.target.value}),n.updateBooksList(n.state._class,e.target.value)},n.updateYears=function(e){if(null!=n.state.rawClasses){var t=n.state.rawClasses.filter((function(t){return t.name==e})).map((function(e){return e.school_year}));n.setState({years:t,year:t[0]}),n.updateBooksList(e,t[0])}},n.updateBooksList=function(e,t){var a=n.state.rawClasses.filter((function(a){return a.name==e&&a.school_year==t}))[0].id;x.request("/classes/"+a+"/books").then((function(e){n.setState({books:e})}))},n.state={classes:[],_class:"",years:[],year:"",books:[]},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){var e=this;x.request("/classes").then((function(t){var a=t.map((function(e){return e.name}));a=Object(ae.a)(new Set(a)).sort(),console.log(t),e.setState({rawClasses:t,classes:a});var n=localStorage.getItem("user_class");n.length>0&&a.includes(n)&&(e.setState({_class:n}),e.updateYears(n))}))}},{key:"render",value:function(){return 0==this.state.classes.length?r.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},r.a.createElement(z.a,null)):r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{variant:"h5",style:{textAlign:"center",marginTop:"15px"}},"Cerca i libri della tua classe!"),r.a.createElement("div",{style:{width:"fit-content",margin:"5px auto"}},r.a.createElement(ne.a,{style:{width:"80px",marginRight:"5px"}},r.a.createElement(re.a,{id:"demo-simple-select-label"},"Classe"),r.a.createElement(oe.a,{labelId:"demo-simple-select-label",onChange:this.handleClassChange,value:this.state._class},this.state.classes.map((function(e){return r.a.createElement(X.a,{value:e},e)})))),r.a.createElement(ne.a,{style:{width:"160px",marginLeft:"5px"}},r.a.createElement(re.a,{id:"demo-simple-select-label"},"Anno scolastico"),r.a.createElement(oe.a,{labelId:"demo-simple-select-label",onChange:this.handleYearChange,value:this.state.year},this.state.years.map((function(e){return r.a.createElement(X.a,{value:e},e,"/",parseInt(e)+1)}))))),this.state.books.length>0?r.a.createElement(we,{books:this.state.books}):null)}}]),a}(r.a.Component),Le=a(216),_e=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(e){var n;return Object(i.a)(this,a),(n=t.call(this,e)).handleQueryChange=function(e){n.setState({loading:!0});var t=e.target.value;t.length<4||"9788"==t.substr(0,4)&&13!=t.length?(clearTimeout(n.state.timer),n.setState({timer:setTimeout((function(){n.setState({books:[],tooShort:!0,loading:!1})}),800)})):(clearTimeout(n.state.timer),n.setState({timer:setTimeout((function(){n.updateBooksList(t)}),300)}),n.setState({tooShort:!1}))},n.updateBooksList=function(e){x.request("/books?search="+encodeURIComponent(e)).then((function(e){n.setState({books:e,loading:!1})}))},n.state={books:[],tooShort:!1,timer:null,loading:null},n}return Object(d.a)(a,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{variant:"h5",style:{textAlign:"center",marginTop:"15px"}},"Inserisci il titolo o il codice ISBN"),r.a.createElement("div",{style:{width:"fit-content",margin:"5px auto"}},r.a.createElement(ne.a,{style:{width:"100%"}},r.a.createElement(f.a,{id:"standard-basic",label:"Ricerca libri",onChange:this.handleQueryChange}))),this.state.tooShort&&!1===this.state.loading?r.a.createElement(de.a,{severity:"warning",style:{maxWidth:"500px",margin:"15px auto"}},r.a.createElement(Le.a,null,"Attenzione"),"Devi inserire almeno ",r.a.createElement("strong",null,"4 caratteri")," oppure il codice ",r.a.createElement("strong",null,"ISBN")," completo!"):0==this.state.books.length&&!1===this.state.loading?r.a.createElement(de.a,{severity:"error",style:{maxWidth:"300px",margin:"15px auto"}},r.a.createElement(Le.a,null,"Attenzione"),"Nessun libro trovato."):!1===this.state.loading&&r.a.createElement(de.a,{severity:"info",style:{maxWidth:"300px",margin:"15px auto"}},1==this.state.books.length?"\xc8 stato trovato":"Sono stati trovati","\xa0",r.a.createElement("strong",null,this.state.books.length)," libr",1==this.state.books.length?"o":"i","."),!0===this.state.loading?r.a.createElement("div",{style:{margin:"30px auto",width:"fit-content"}},r.a.createElement(z.a,null)):this.state.books.length>0?r.a.createElement(we,{books:this.state.books}):null)}}]),a}(r.a.Component),De=Object(K.a)((function(e){return{root:{display:"flex"},drawer:Object(p.a)({},e.breakpoints.up("md"),{width:240,flexShrink:0}),appBar:{zIndex:e.zIndex.drawer+1},menuButton:Object(p.a)({marginRight:e.spacing(2)},e.breakpoints.up("md"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:240},content:Object(p.a)({flexGrow:1,padding:e.spacing(3),marginTop:"54px"},e.breakpoints.down("xs"),{marginTop:"40px"}),closeMenuButton:{marginRight:"auto",marginLeft:0}}}));var ze=function(e){var t=De(),a=Object(U.a)(),n=r.a.useState(!1),o=Object(P.a)(n,2),l=o[0],i=o[1],s=r.a.useState(null),c=Object(P.a)(s,2),p=c[0],d=c[1];function h(){i(!l)}var f=function(){d(null)},E=r.a.createElement("div",null,r.a.createElement("div",{style:{padding:"12px"}},r.a.createElement(ee,null),r.a.createElement(R.a,{edge:"start",color:"inherit",style:{margin:0,padding:0,float:"right"},onClick:function(e){d(e.currentTarget)}},r.a.createElement(G.a,null,"expand_more")),r.a.createElement($.a,{anchorEl:p,keepMounted:!0,open:Boolean(p),onClose:f},r.a.createElement(X.a,{onClick:f,component:u.b,to:"/profile"},"Profilo"),r.a.createElement(X.a,{onClick:function(){f(),x.logout(),e.checkLogin()}},"Logout"))),r.a.createElement(Q.a,{variant:"middle",style:{margin:"0"}}),r.a.createElement(W.a,null,r.a.createElement(H.a,{button:!0,key:"/",component:u.b,exact:!0,to:"/",activeClassName:"Mui-selected"},r.a.createElement(V.a,{primary:"Home"})),r.a.createElement(H.a,{button:!0,key:"/books",component:u.b,to:"/books",activeClassName:"Mui-selected"},r.a.createElement(V.a,{primary:"Ricerca libri"})),r.a.createElement(H.a,{button:!0,key:"/class-books",component:u.b,to:"/class-books",activeClassName:"Mui-selected"},r.a.createElement(V.a,{primary:"Ricerca libri classe"}))));return r.a.createElement("div",{className:t.root},r.a.createElement(M.a,null),r.a.createElement(j.a,{position:"fixed",className:t.appBar},r.a.createElement(B.a,null,r.a.createElement(R.a,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:h,className:t.menuButton},r.a.createElement(J.a,null)),r.a.createElement(g.a,{variant:"h6",noWrap:!0},"PALEObooks"))),r.a.createElement("nav",{className:t.drawer},r.a.createElement(N.a,{mdUp:!0,implementation:"css"},r.a.createElement(A.a,{variant:"temporary",anchor:"rtl"===a.direction?"right":"left",open:l,onClose:h,classes:{paper:t.drawerPaper},ModalProps:{keepMounted:!0}},E)),r.a.createElement(N.a,{smDown:!0,implementation:"css"},r.a.createElement(A.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper}},r.a.createElement("div",{className:t.toolbar}),E))),r.a.createElement("div",{className:t.content},r.a.createElement("div",null,r.a.createElement(m.d,null,r.a.createElement(m.b,{exact:!0,path:"/"},r.a.createElement(F,{checkLogin:e.checkLogin})),r.a.createElement(m.b,{path:"/profile"},r.a.createElement(te,null)),r.a.createElement(m.b,{path:"/books"},r.a.createElement(_e,null)),r.a.createElement(m.b,{path:"/class-books"},r.a.createElement(Ie,null))))))},Te=function(e){Object(s.a)(a,e);var t=Object(c.a)(a);function a(){var e;return Object(i.a)(this,a),(e=t.call(this)).componentDidMount=function(){e.chechLogin(),setTimeout((function(){null===e.state.isLoggedIn&&e.setState({error:!0})}),5e3)},e.chechLogin=function(){x.isLoggedIn().then((function(){e.setState({isLoggedIn:!0,wasInitialized:!0}),console.log(!0)})).catch((function(){e.setState({isLoggedIn:!1,wasInitialized:!0}),console.log(!1)}))},e.render=function(){return!0===e.state.error?r.a.createElement("div",{style:{textAlign:"center"}},r.a.createElement("h1",null,"Impossibile comunicare con il server"),r.a.createElement("h2",null,"Riprova pi\xf9 tardi"),r.a.createElement("h4",null,"PALEObooks")):null===e.state.isLoggedIn?r.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},r.a.createElement(z.a,null)):r.a.createElement(u.a,null,r.a.createElement(m.d,null,r.a.createElement(m.b,{exact:!0,path:"/login"},e.state.isLoggedIn?r.a.createElement(m.a,{to:""}):r.a.createElement(D,{checkLogin:e.chechLogin})),r.a.createElement(q,{auth:e.state.isLoggedIn,wasInitialized:e.state.wasInitialized,exact:!0,component:function(){return r.a.createElement(ze,{checkLogin:e.chechLogin})},path:"*"}),r.a.createElement(m.b,{path:"*"},r.a.createElement(m.a,{to:""}))))},e.state={error:!1,isLoggedIn:null,wasInitialized:!1},e}return a}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Te,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[128,1,2]]]);
//# sourceMappingURL=main.114bcf39.chunk.js.map