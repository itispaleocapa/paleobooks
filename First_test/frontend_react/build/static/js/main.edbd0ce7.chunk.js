(this.webpackJsonpfrontend_react=this.webpackJsonpfrontend_react||[]).push([[0],{103:function(e,t,a){e.exports=a(122)},108:function(e,t,a){},109:function(e,t,a){e.exports=a.p+"static/media/logo.5d5d9eef.svg"},110:function(e,t,a){},122:function(e,t,a){"use strict";a.r(t);var n=a(0),o=a.n(n),l=a(11),i=a.n(l),r=(a(108),a(19)),c=a(22),s=a(21),m=(a(109),a(110),a(32)),u=a(12),d=a(44),p=a(26),g=a(177),h=a(48),f=a(205),E=a(84),b=a(183),v=a(184),y=a(185),k=a(186),w=a(187),x=a(188),C={request:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"GET",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Promise((function(n,o){fetch("https://www.paleobooks.it/pbapi/public"+e,{method:t,headers:{"Content-Type":"application/json",Authorization:"Bearer "+sessionStorage.getItem("access_token")},body:a}).then((function(e){200!==e.status?o():e.json().then((function(e){n(e)}))}))}))},login:function(e,t){return new Promise((function(a,n){C.request("/auth/login","POST",JSON.stringify({email:e,password:t})).then((function(e){var t=new Date;t.setFullYear(t.getFullYear()+1),sessionStorage.setItem("access_token",e.access_token),document.cookie="refresh_token="+e.refresh_token+"; expires="+t.toUTCString()+"; path=/",a()})).catch((function(){n()}))}))},loginPaleoID:function(e){return new Promise((function(t,a){C.request("/auth/paleoid","POST",JSON.stringify({code:e})).then((function(e){var a=new Date;a.setFullYear(a.getFullYear()+1),sessionStorage.setItem("access_token",e.access_token),document.cookie="refresh_token="+e.refresh_token+"; expires="+a.toUTCString()+"; path=/",t()})).catch((function(){a()}))}))},logout:function(){var e=new Date;e.setFullYear(e.getFullYear()+1),sessionStorage.setItem("access_token",null),document.cookie="refresh_token=; expires="+e.toUTCString()+"; path=/"},isLoggedIn:function(){return new Promise((function(e,t){C.request("/users/profile").then((function(t){e()})).catch((function(){t()}))}))}},O=C,L=a(176),I=a(172),j=a(182),S=a(79),T=a.n(S),P=function(e){Object(c.a)(a,e);var t=Object(s.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleInputChange=function(e,t){n.setState(Object(d.a)({},e,t.target.value))},n.handleKeyPress=function(e){"Enter"===e.key&&n.handleLogin()},n.handleLogin=function(){n.setState({isLoading:!0}),O.login(n.state.email,n.state.password).then((function(e){n.props.checkLogin()})).catch((function(){n.setState({dialogTitle:"Errore",dialogContent:"Credenziali non valide",dialogOpen:!0}),n.setState({isLoading:!1})}))},n.handleRegistrationBtn=function(){n.setState({dialogTitle:"Attenzione",dialogContent:"Questa funzione non \xe8 ancora disponibile",dialogOpen:!0})},n.dialogHandleClose=function(){n.setState({dialogOpen:!1})},n.state={name:"",email:"",password:"",isLoading:!1},n.state.paleoIdUrl="https://id.paleo.bg.it/oauth/authorize?client_id=ae13b6e3fd3c0fccad39c5fcb8fda00d&response_type=code&state=paleobooks&redirect_uri="+encodeURIComponent("https://www.paleobooks.it/pbr/login"),n}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this,t=T.a.parse(this.props.location.search);"paleobooks"===t.state&&(this.setState({isLoading:!0}),O.loginPaleoID(t.code).then((function(){e.props.checkLogin()})).catch((function(){e.setState({dialogTitle:"Errore",dialogContent:"Autenticazione con PaleoID fallita",dialogOpen:!0}),e.setState({isLoading:!1})})))}},{key:"render",value:function(){var e=this;return o.a.createElement(o.a.Fragment,null,o.a.createElement(I.a,{position:"static",style:{alignItems:"center"}},o.a.createElement(L.a,null,o.a.createElement(h.a,{variant:"h6"},"PaleoBooks"))),o.a.createElement(g.a,{style:{alignItems:"center",marginTop:"10px"}},o.a.createElement("img",{src:"https://i.imgur.com/jMTzBKa.png",style:{width:"30%",maxWidth:"175px",margin:"15px auto",display:"block"}}),o.a.createElement(E.a,{style:{maxWidth:"500px",padding:"15px",margin:"0 auto"}},o.a.createElement("form",{noValidate:!0,autoComplete:"off"},o.a.createElement(h.a,{variant:"h4",style:{textAlign:"center"}},"Login"),o.a.createElement(f.a,{id:"outlined-basic",label:"Email",variant:"outlined",fullWidth:!0,style:{marginTop:"10px"},onChange:function(t){return e.handleInputChange("email",t)},onKeyPress:this.handleKeyPress,autoFocus:!0}),o.a.createElement(f.a,{id:"outlined-basic",label:"Password",variant:"outlined",fullWidth:!0,type:"password",style:{marginTop:"10px"},onChange:function(t){return e.handleInputChange("password",t)},onKeyPress:this.handleKeyPress}),this.state.isLoading?o.a.createElement(j.a,{style:{margin:"8px"}}):o.a.createElement("div",{style:{marginTop:"20px"}}),o.a.createElement("div",{style:{width:"fit-content",margin:"0px auto 10px"}},o.a.createElement(b.a,{variant:"contained",style:{marginRight:"4px"},onClick:this.handleLogin},"Accedi"),o.a.createElement(b.a,{variant:"contained",style:{marginLeft:"4px"},onClick:this.handleRegistrationBtn},"Registrati")),o.a.createElement("div",{style:{width:"fit-content",margin:"20px auto 0px"}},o.a.createElement(b.a,{variant:"contained",color:"primary",href:this.state.paleoIdUrl},"Accedi con PaleoID")))),o.a.createElement(v.a,{open:this.state.dialogOpen,onClose:this.dialogHandleClose,"aria-labelledby":"alert-dialog-title","aria-describedby":"alert-dialog-description"},o.a.createElement(y.a,{id:"alert-dialog-title"},this.state.dialogTitle),o.a.createElement(k.a,null,o.a.createElement(w.a,{id:"alert-dialog-description"},this.state.dialogContent)),o.a.createElement(x.a,null,o.a.createElement(b.a,{onClick:this.dialogHandleClose,color:"primary",autoFocus:!0},"Chiudi")))))}}]),a}(o.a.Component),_=Object(u.g)(P),B=a(189),z=a(83),F=function(e){var t=e.component,a=e.auth,n=e.wasInitialized,l=Object(z.a)(e,["component","auth","wasInitialized"]);return o.a.createElement(u.b,Object.assign({},l,{render:function(e){return!0===a?o.a.createElement(t,e):n?o.a.createElement(u.a,{to:"/login"}):""}}))},D=function(e){Object(c.a)(a,e);var t=Object(s.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleLogout=function(){O.logout(),n.props.checkLogin()},n}return Object(p.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(h.a,{variant:"h4",style:{textAlign:"center",marginTop:"15px"}},"Ciao, sono la home page!"),o.a.createElement(b.a,{variant:"contained",color:"secondary",style:{margin:"10px auto",display:"block"},onClick:this.handleLogout},"Logout"))}}]),a}(o.a.Component),M=a(67),N=a(202),A=a(207),R=a(204),Y=a(198),q=a(181),U=a(124),W=a(201),K=a(80),H=a.n(K),J=a(197),G=a(13),Q=a(200),V=a(199),$=a(81),X=a(190),Z=a(206),ee=function(e){Object(c.a)(n,e);var t=Object(s.a)(n);function n(){var e;return Object(r.a)(this,n),(e=t.call(this)).state={name:"",email:"",emailmd5:""},e}return Object(p.a)(n,[{key:"componentDidMount",value:function(){var e=this;O.request("/users/profile").then((function(t){var n=a(117);e.setState({name:t.name,email:t.email,emailmd5:n(t.email.toLowerCase())})}))}},{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(Z.a,{alt:"Remy Sharp",src:"https://gravatar.com/avatar/"+this.state.emailmd5+"&d=identicon",style:{width:"56px",height:"56px"}}),o.a.createElement(h.a,{variant:"subtitle1",gutterBottom:!0,style:{marginTop:"0.4rem",marginBottom:"-0.3rem"}},this.state.name),o.a.createElement(h.a,{variant:"caption",gutterBottom:!0},this.state.email))}}]),n}(o.a.Component),te=function(e){Object(c.a)(a,e);var t=Object(s.a)(a);function a(e){return Object(r.a)(this,a),t.call(this,e)}return Object(p.a)(a,[{key:"render",value:function(){return o.a.createElement(o.a.Fragment,null,o.a.createElement(h.a,{variant:"h4",style:{textAlign:"center",marginTop:"15px"}},"Questa \xe8 la pagina del profilo"))}}]),a}(o.a.Component),ae=a(82),ne=a(180),oe=a(208),le=a(203),ie=a(191),re=a(192),ce=a(193),se=a(194),me=a(195),ue=a(196),de=function(e){Object(c.a)(a,e);var t=Object(s.a)(a);function a(e){var n;return Object(r.a)(this,a),(n=t.call(this,e)).handleClassChange=function(e){n.setState({_class:e.target.value});var t=n.state.rawClasses.filter((function(t){return t.name==e.target.value})).map((function(e){return e.school_year}));n.setState({years:t,year:t[0]}),n.updateBooksList(e.target.value,t[0])},n.handleYearChange=function(e){n.setState({year:e.target.value}),n.updateBooksList(n.state._class,e.target.value)},n.updateBooksList=function(e,t){var a=n.state.rawClasses.filter((function(a){return a.name==e&&a.school_year==t}))[0].id;O.request("/classes/"+a+"/books").then((function(e){n.setState({books:e})}))},n.state={classes:[],_class:"",years:[],year:"",books:[]},n}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this;O.request("/classes").then((function(t){var a=t.map((function(e){return e.name}));a=Object(ae.a)(new Set(a)),console.log(t),e.setState({rawClasses:t,classes:a})}))}},{key:"render",value:function(){return 0==this.state.classes.length?o.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},o.a.createElement(B.a,null)):o.a.createElement(o.a.Fragment,null,o.a.createElement(h.a,{variant:"h5",style:{textAlign:"center",marginTop:"15px"}},"Cerca i libri della tua classe!"),o.a.createElement("div",{style:{width:"fit-content",margin:"5px auto"}},o.a.createElement(ne.a,{style:{width:"80px",marginRight:"5px"}},o.a.createElement(oe.a,{id:"demo-simple-select-label"},"Classe"),o.a.createElement(le.a,{labelId:"demo-simple-select-label",onChange:this.handleClassChange,value:this.state._class},this.state.classes.map((function(e){return o.a.createElement(X.a,{value:e},e)})))),o.a.createElement(ne.a,{style:{width:"160px",marginLeft:"5px"}},o.a.createElement(oe.a,{id:"demo-simple-select-label"},"Anno scolastico"),o.a.createElement(le.a,{labelId:"demo-simple-select-label",onChange:this.handleYearChange,value:this.state.year},this.state.years.map((function(e){return o.a.createElement(X.a,{value:e},e,"/",parseInt(e)+1)}))))),this.state.books.length>0?o.a.createElement(ie.a,{component:E.a,style:{marginTop:"20px"}},o.a.createElement(re.a,{"aria-label":"simple table"},o.a.createElement(ce.a,null,o.a.createElement(se.a,null,o.a.createElement(me.a,{align:"center"},"Immagine"),o.a.createElement(me.a,{align:"left"},"Titolo"),o.a.createElement(me.a,{align:"left"},"ISBN"),o.a.createElement(me.a,{align:"left"},"Prezzo"))),o.a.createElement(ue.a,null,this.state.books.map((function(e){return o.a.createElement(se.a,{key:e.id},o.a.createElement(me.a,{align:"center"},o.a.createElement("img",{src:e.photo,height:"100px"})),o.a.createElement(me.a,{align:"left"},e.title),o.a.createElement(me.a,{align:"left"},e.isbn),o.a.createElement(me.a,{align:"left"},"\u20ac",e.price))}))))):null)}}]),a}(o.a.Component),pe=Object(J.a)((function(e){return{root:{display:"flex"},drawer:Object(d.a)({},e.breakpoints.up("md"),{width:240,flexShrink:0}),appBar:{zIndex:e.zIndex.drawer+1},menuButton:Object(d.a)({marginRight:e.spacing(2)},e.breakpoints.up("md"),{display:"none"}),toolbar:e.mixins.toolbar,drawerPaper:{width:240},content:Object(d.a)({flexGrow:1,padding:e.spacing(3),marginTop:"54px"},e.breakpoints.down("xs"),{marginTop:"40px"}),closeMenuButton:{marginRight:"auto",marginLeft:0}}}));var ge=function(e){var t=pe(),a=Object(G.a)(),n=o.a.useState(!1),l=Object(M.a)(n,2),i=l[0],r=l[1],c=o.a.useState(null),s=Object(M.a)(c,2),d=s[0],p=s[1];function g(){r(!i)}var f=function(){p(null)},E=o.a.createElement("div",null,o.a.createElement("div",{style:{padding:"12px"}},o.a.createElement(ee,null),o.a.createElement(Y.a,{edge:"start",color:"inherit",style:{margin:0,padding:0,float:"right"},onClick:function(e){p(e.currentTarget)}},o.a.createElement(V.a,null,"expand_more")),o.a.createElement($.a,{anchorEl:d,keepMounted:!0,open:Boolean(d),onClose:f},o.a.createElement(X.a,{onClick:f,component:m.b,to:"/profile"},"Profilo"),o.a.createElement(X.a,{onClick:function(){f(),O.logout(),e.checkLogin()}},"Logout"))),o.a.createElement(Q.a,{variant:"middle",style:{margin:"0"}}),o.a.createElement(q.a,null,o.a.createElement(U.a,{button:!0,key:"/",component:m.b,exact:!0,to:"/",activeClassName:"Mui-selected"},o.a.createElement(W.a,{primary:"Home"})),o.a.createElement(U.a,{button:!0,key:"/class-books",component:m.b,to:"/class-books",activeClassName:"Mui-selected"},o.a.createElement(W.a,{primary:"Ricerca libri classe"}))));return o.a.createElement("div",{className:t.root},o.a.createElement(N.a,null),o.a.createElement(I.a,{position:"fixed",className:t.appBar},o.a.createElement(L.a,null,o.a.createElement(Y.a,{color:"inherit","aria-label":"Open drawer",edge:"start",onClick:g,className:t.menuButton},o.a.createElement(H.a,null)),o.a.createElement(h.a,{variant:"h6",noWrap:!0},"PaleoBooks"))),o.a.createElement("nav",{className:t.drawer},o.a.createElement(R.a,{mdUp:!0,implementation:"css"},o.a.createElement(A.a,{variant:"temporary",anchor:"rtl"===a.direction?"right":"left",open:i,onClose:g,classes:{paper:t.drawerPaper},ModalProps:{keepMounted:!0}},E)),o.a.createElement(R.a,{smDown:!0,implementation:"css"},o.a.createElement(A.a,{className:t.drawer,variant:"permanent",classes:{paper:t.drawerPaper}},o.a.createElement("div",{className:t.toolbar}),E))),o.a.createElement("div",{className:t.content},o.a.createElement("div",null,o.a.createElement(u.d,null,o.a.createElement(u.b,{exact:!0,path:"/"},o.a.createElement(D,{checkLogin:e.checkLogin})),o.a.createElement(u.b,{path:"/profile"},o.a.createElement(te,null)),o.a.createElement(u.b,{path:"/class-books"},o.a.createElement(de,null))))))},he=function(e){Object(c.a)(a,e);var t=Object(s.a)(a);function a(){var e;return Object(r.a)(this,a),(e=t.call(this)).componentDidMount=function(){e.chechLogin(),setTimeout((function(){null===e.state.isLoggedIn&&e.setState({error:!0})}),5e3)},e.chechLogin=function(){O.isLoggedIn().then((function(){e.setState({isLoggedIn:!0,wasInitialized:!0}),console.log(!0)})).catch((function(){e.setState({isLoggedIn:!1,wasInitialized:!0}),console.log(!1)}))},e.render=function(){return!0===e.state.error?o.a.createElement("div",{style:{textAlign:"center"}},o.a.createElement("h1",null,"Impossibile comunicare con il server"),o.a.createElement("h2",null,"Riprova pi\xf9 tardi"),o.a.createElement("h4",null,"PaleoBooks")):null===e.state.isLoggedIn?o.a.createElement("div",{style:{margin:"20px auto",width:"fit-content"}},o.a.createElement(B.a,null)):o.a.createElement(m.a,{basename:"/pbr/"},o.a.createElement(u.d,null,o.a.createElement(u.b,{exact:!0,path:"/login"},e.state.isLoggedIn?o.a.createElement(u.a,{to:""}):o.a.createElement(_,{checkLogin:e.chechLogin})),o.a.createElement(F,{auth:e.state.isLoggedIn,wasInitialized:e.state.wasInitialized,exact:!0,component:function(){return o.a.createElement(ge,{checkLogin:e.chechLogin})},path:"*"}),o.a.createElement(u.b,{path:"*"},o.a.createElement(u.a,{to:""}))))},e.state={error:!1,isLoggedIn:null,wasInitialized:!1},e}return a}(o.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(he,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[103,1,2]]]);
//# sourceMappingURL=main.edbd0ce7.chunk.js.map